<!-- Common HTML template code for all the dashboard pages -->
{% extends 'FileSaver/base.html' %}

<!-- Title block for all the webpages -->
{% block title %}
  Live Statistics - Sitewise
{% endblock %}

<!-- Load static images, css and js defined in STATIC_URL in settings.py -->
{% load static %}

<!-- 
  Four parameters are displayed on cards:
  1. Daily generation in kWh
  2. Daily generation in % PLF
  3. Performance Ratio in %
  4. Inclined irradiance (in kWh/m2)

  and the graph is drawn with the help of charts.js library using the calculated data
-->
  {% block main_content %}

    <!-- Main Cards area -->
    <main class="mt-5 pt-4">
        <div class="container-fluid">
            <div class="row">
                <div class="col-md-12 fw-normal fs-4 text-uppercase">Latest Statistics</div>
            </div>
            <div class="accordion" id="accordionPanelsStayOpenExample">
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingOne">
                  <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseOne" aria-expanded="true" aria-controls="panelsStayOpen-collapseOne">
                    Site Beawar - {{ bcount }} invertors
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseOne" class="accordion-collapse collapse show" aria-labelledby="panelsStayOpen-headingOne">
                  <div class="accordion-body">
                    <div class="row mt-2">
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in Kwh) card -->
                            <div class="card text-white bg-primary bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ beawar_object.daily_actual_generation }}</span><br> kWh</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in %PLF) card -->
                            <div class="card text-white bg-success bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ beawar_object.daily_actual_plf }}</span><br> % PLF</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <center>

                          <!-- Chart area for Beawar site -->
                          <canvas id="myChart-Beawar" width="200" height="150"></canvas>
                        </center>
                      </div>
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Performance Ratio card -->
                            <div class="card text-white bg-warning bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ beawar_object.daily_actual_performance_ratio }}</span> <br>%</h2>
                              </div>
                              <div class="card-header fs-5">Performance Ratio</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Inclined irradiance card -->
                            <div class="card text-white bg-danger bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ beawar_object.monthly_actual_irradiance }}</span><br> kWh/m<sup>2</sup></h2>
                              </div>
                              <div class="card-header fs-5">Inclined irradiance</div>
                            </div>
                          </center>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingTwo">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseTwo" aria-expanded="false" aria-controls="panelsStayOpen-collapseTwo">
                    Site Panipat - {{ pcount }} invertors
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseTwo" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingTwo">
                  <div class="accordion-body">
                    <div class="row mt-2">
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in Kwh) card -->
                            <div class="card text-white bg-primary bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ panipat_object.daily_actual_generation }}</span><br> kWh</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in %PLF) card -->
                            <div class="card text-white bg-success bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ panipat_object.daily_actual_plf }}</span><br> % PLF</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <center>

                          <!-- Chart area for Beawar site -->
                          <canvas id="myChart-Panipat" width="200" height="150"></canvas>
                        </center>
                      </div>
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Performance Ratio card -->
                            <div class="card text-white bg-warning bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ panipat_object.daily_actual_performance_ratio }}</span><br> %</h2>
                              </div>
                              <div class="card-header fs-5">Performance Ratio</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Inclined irradiance card -->
                            <div class="card text-white bg-danger bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ panipat_object.monthly_actual_irradiance }}</span><br> kWh/m<sup>2</sup></h2>
                              </div>
                              <div class="card-header fs-5">Inclined irradiance</div>
                            </div>
                          </center>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingThree">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseThree" aria-expanded="false" aria-controls="panelsStayOpen-collapseThree">
                    Site Roorkee - {{ rcount }} invertors
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseThree" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingThree">
                  <div class="accordion-body">
                    <div class="row mt-2">
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in Kwh) card -->
                            <div class="card text-white bg-primary bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ roorkee_object.daily_actual_generation }}</span><br> kWh</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in %PLF) card -->
                            <div class="card text-white bg-success bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ roorkee_object.daily_actual_plf }}</span><br> % PLF</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <center>

                          <!-- Chart area for Beawar site -->
                          <canvas id="myChart-Roorkee" width="200" height="150"></canvas>
                        </center>
                      </div>
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Performance Ratio card -->
                            <div class="card text-white bg-warning bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ roorkee_object.daily_actual_performance_ratio }}</span><br> %</h2>
                              </div>
                              <div class="card-header fs-5">Performance Ratio</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Inclined irradiance card -->
                            <div class="card text-white bg-danger bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ roorkee_object.monthly_actual_irradiance }}</span><br> kWh/m<sup>2</sup></h2>
                              </div>
                              <div class="card-header fs-5">Inclined irradiance</div>
                            </div>
                          </center>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingFour">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseFour" aria-expanded="false" aria-controls="panelsStayOpen-collapseFour">
                    Site Jharkhand - {{ jcount }} invertors
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseFour" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingFour">
                  <div class="accordion-body">
                    <div class="row mt-2">
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in Kwh) card -->
                            <div class="card text-white bg-primary bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ jharkhand_object.daily_actual_generation }}</span><br> kWh</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Daily Solar Generation (in %PLF) card -->
                            <div class="card text-white bg-success bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ jharkhand_object.daily_actual_plf }}</span><br> % PLF</h2>
                              </div>
                              <div class="card-header fs-5">Daily Solar Generation</div>
                            </div>
                          </center>
                        </div>
                      </div>
                      <div class="col-12 col-md-6">
                        <center>

                          <!-- Chart area for Beawar site -->
                          <canvas id="myChart-Jharkhand" width="200" height="150"></canvas>
                        </center>
                      </div>
                      <div class="col-12 col-md-3">
                        <div class="col-12">
                          <center>

                            <!-- Performance Ratio card -->
                            <div class="card text-white bg-warning bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ jharkhand_object.daily_actual_performance_ratio }}</span><br> %</h2>
                              </div>
                              <div class="card-header fs-5">Performance Ratio</div>
                            </div>
                          </center>
                        </div>
                        <div class="col-12">
                          <center>

                            <!-- Inclined irradiance card -->
                            <div class="card text-white bg-danger bg-gradient mb-3" style="max-width: 20rem;">
                              <div class="card-body">
                                <h2 class="card-title display-6"><span class="fw-bold">{{ jharkhand_object.monthly_actual_irradiance }}</span><br> kWh/m<sup>2</sup></h2>
                              </div>
                              <div class="card-header fs-5">Inclined irradiance</div>
                            </div>
                          </center>
                        </div>
                      </div>
                    </div>


                  </div>
                </div>
              </div>
              <div class="accordion-item">
                <h2 class="accordion-header" id="panelsStayOpen-headingFive">
                  <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapseFive" aria-expanded="false" aria-controls="panelsStayOpen-collapseFive">
                    Site Castamet - {{ ccount }} invertors
                  </button>
                </h2>
                <div id="panelsStayOpen-collapseFive" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-headingFive">
                  <div class="accordion-body">
                    <div class="accordion-body">
                      <div class="row mt-2">
                        <div class="col-12 col-md-3">
                          <div class="col-12">
                            <center>

                              <!-- Daily Solar Generation (in Kwh) card -->
                              <div class="card text-white bg-primary bg-gradient mb-3" style="max-width: 20rem;">
                                <div class="card-body">
                                  <h2 class="card-title display-6"><span class="fw-bold">{{ castamet_object.daily_actual_generation }}</span><br> kWh</h2>
                                </div>
                                <div class="card-header fs-5">Daily Solar Generation</div>
                              </div>
                            </center>
                          </div>
                          <div class="col-12">
                            <center>

                              <!-- Daily Solar Generation (in %PLF) card -->
                              <div class="card text-white bg-success bg-gradient mb-3" style="max-width: 20rem;">
                                <div class="card-body">
                                  <h2 class="card-title display-6"><span class="fw-bold">{{ castamet_object.daily_actual_plf }}</span><br> % PLF</h2>
                                </div>
                                <div class="card-header fs-5">Daily Solar Generation</div>
                              </div>
                            </center>
                          </div>
                        </div>
                        <div class="col-12 col-md-6">
                          <center>

                            <!-- Chart area for Beawar site -->
                            <canvas id="myChart-Castamet" width="200" height="150"></canvas>
                          </center>
                        </div>
                        <div class="col-12 col-md-3">
                          <div class="col-12">
                            <center>

                              <!-- Performance Ratio card -->
                              <div class="card text-white bg-warning bg-gradient mb-3" style="max-width: 20rem;">
                                <div class="card-body">
                                  <h2 class="card-title display-6"><span class="fw-bold">{{ castamet_object.daily_actual_performance_ratio }}</span><br> %</h2>
                                </div>
                                <div class="card-header fs-5">Performance Ratio</div>
                              </div>
                            </center>
                          </div>
                          <div class="col-12">
                            <center>

                              <!-- Inclined irradiance card -->
                              <div class="card text-white bg-danger bg-gradient mb-3" style="max-width: 20rem;">
                                <div class="card-body">
                                  <h2 class="card-title display-6"><span class="fw-bold">{{ castamet_object.monthly_actual_irradiance }}</span><br> kWh/m<sup>2</sup></h2>
                                </div>
                                <div class="card-header fs-5">Inclined irradiance</div>
                              </div>
                            </center>
                          </div>
                        </div>
                      </div>
  
  
                    </div>
                  </div>
                </div>
              </div>
            </div>
        </div>
    </main>
  {% endblock %}
    <!-- Main cards area -->


    {% block extra_scripts %}
          {{ beawar_gen|json_script:"beawar-data" }}    
          {{ panipat_gen|json_script:"panipat-data" }}
          {{ jharkhand_gen|json_script:"jharkhand-data" }}
          {{ castamet_gen|json_script:"castamet-data" }}
          {{ roorkee_gen|json_script:"roorkee-data" }}
          <script>
            const beawarData = JSON.parse(document.getElementById('beawar-data').textContent);
            const panipatData = JSON.parse(document.getElementById('panipat-data').textContent);
            const jharkhandData = JSON.parse(document.getElementById('jharkhand-data').textContent);
            const castametData = JSON.parse(document.getElementById('castamet-data').textContent);
            const roorkeeData = JSON.parse(document.getElementById('roorkee-data').textContent);

            // console.log(beawarData);
            // console.log(panipatData);
            console.log(jharkhandData);
            console.log(castametData);
            console.log(roorkeeData);


            const beawarInvertors = []
            const panipatInvertors = []
            const jharkhandInvertors = []
            const castametInvertors = []
            const roorkeeInvertors = []

            for(let i=1; i<=beawarData.length; i++) {
              beawarInvertors.push('Invertor-'+i);
            }
            for(let i=1; i<=panipatData.length; i++) {
              panipatInvertors.push('Invertor-'+i);
            }
            for(let i=1; i<=jharkhandData.length; i++) {
              jharkhandInvertors.push('Invertor-'+i);
            }
            for(let i=1; i<=castametData.length; i++) {
              castametInvertors.push('Invertor-'+i);
            }
            for(let i=1; i<=roorkeeData.length; i++) {
              roorkeeInvertors.push('Invertor-'+i);
            }
            // Variables for creating generation chart using ChartJS
            var ctxBeawar = document.getElementById('myChart-Beawar').getContext('2d');
            var ctxPanipat = document.getElementById('myChart-Panipat').getContext('2d');
            var ctxRoorkee = document.getElementById('myChart-Roorkee').getContext('2d');
            var ctxJharkhand = document.getElementById('myChart-Jharkhand').getContext('2d');
            var ctxCastamet = document.getElementById('myChart-Castamet').getContext('2d');


            // Making solar generation chart for site Beawar
            var myChartBeawar = new Chart(ctxBeawar, {
                type: 'bar',
                data: {

                    // define the labels for each invertor
                    labels: beawarInvertors,

                    // define the value of each bar,
                    //            color of each bar,
                    //            border-color and border-width of each bar
                    //            and the label for the chart(define the legends)

                    datasets: [{
                        label: 'Daily Solar generation(in kWh)',
                        data: beawarData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                        ],
                        borderWidth: 1
                    }]
                },

                // define the starting point of the graph, maybe use kink for bigger graphs
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var myChartPanipat = new Chart(ctxPanipat, {
              type: 'bar',
                data: {

                  // define the labels for each invertor
                    labels: panipatInvertors,

                    // define the value of each bar,
                    //            color of each bar,
                    //            border-color and border-width of each bar
                    //            and the label for the chart(define the legends)
                    datasets: [{
                        label: 'Daily Solar generation(in kWh)',
                        data: panipatData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },

                // define the starting point of the graph, maybe use kink for bigger graphs
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: false,
                            stepSize: 70,
                        },
                    }
                }
            });

            var myChartRoorkee = new Chart(ctxRoorkee, {
                type: 'bar',
                data: {

                    // define the labels for each invertor
                    labels: roorkeeInvertors,

                    // define the value of each bar,
                    //            color of each bar,
                    //            border-color and border-width of each bar
                    //            and the label for the chart(define the legends)
                    datasets: [{
                        label: 'Daily Solar generation(in kWh)',
                        data: roorkeeData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },

                // define the starting point of the graph, maybe use kink for bigger graphs
                options: {
                    responsive: true,
                    // maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var myChartJharkhand = new Chart(ctxJharkhand, {
                type: 'bar',
                data: {
                    // define the labels for each invertor
                    labels: jharkhandInvertors,

                    // define the value of each bar,
                    //            color of each bar,
                    //            border-color and border-width of each bar
                    //            and the label for the chart(define the legends)
                    datasets: [{
                        label: 'Daily Solar generation(in kWh)',
                        data: jharkhandData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },

                // define the starting point of the graph, maybe use kink for bigger graphs
                options: {
                    responsive: true,
                    // maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });

            var myChartCastamet = new Chart(ctxCastamet, {
                type: 'bar',
                data: {
                    // define the labels for each invertor
                    labels: castametInvertors,

                    // define the value of each bar,
                    //            color of each bar,
                    //            border-color and border-width of each bar
                    //            and the label for the chart(define the legends)
                    datasets: [{
                        label: 'Daily Solar generation(in kWh)',
                        data: castametData,
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)',
                            'rgba(255, 159, 64, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)',
                            'rgba(255, 159, 64, 1)'
                        ],
                        borderWidth: 1
                    }]
                },

                // define the starting point of the graph, maybe use kink for bigger graphs
                options: {
                    responsive: true,
                    // maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
            </script>
    {% endblock %}


